<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>EPUB.js Pagination Example</title>

    <script src="../dist/epub.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.5/jszip.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+Devanagari:wght@200&family=Roboto+Serif:wght@100&display=swap" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="examples.css" />
  </head>
  <body>
    <div id="main">
			<div style="vertical-align: middle; text-align: center;">
				<select id="languagePreferenceDropdown" onchange="changeLanguagePrefernce()">
					<option value="devanagari">श्रीज्ञानेश्वरी अध्याय १ ला</option>
					<option value="transliterated" selected>ShreeJñāneshwarī Adhyay 1 Transliterated</option>
				</select>
			</div>
      <div id="viewer" class="spreads loading">
			</div>
      <span id="hiddenTitle"></span>
      <a id="prev" href="#prev" class="arrow">‹</a>
      <a id="next" href="#next" class="arrow">›</a>
    </div>
    <div id="navigation">
      <a id="closer">
        <i class="material-icons">close</i>
      </a>
      <h1 id="title">...</h1>
      <image id="cover" width="150px" />
      <h2 id="author">...</h2>
      <ul id="toc"></ul>
    </div>

    <script>
      var currentLanguagePreferenceDropdown = 'transliterated';
      var book, rendition;

      const changeLanguagePrefernce = () => {
        const newlyChosenLanguage = document.getElementById('languagePreferenceDropdown').value;
				// reload book
				if (newlyChosenLanguage === 'transliterated') {
					loadBook('http://localhost:8080/examples/books/Jnaneshwari/Jnaneshwar-Adhyay-1-TX/EPUB/content.opf');
				} else if (newlyChosenLanguage === 'devanagari') {
					loadBook('http://localhost:8080/examples/books/Jnaneshwari/Jnaneshwar-Adhyay-1-Devanagari/EPUB/content.opf');
				}
				else {
					alert('Error loading book for the chosen language ' + newlyChosenLanguage);
				}
      };

			const goToNextPage = () => {
				rendition.next()
			}

			const goToPrevPage = () => {
				rendition.prev()
			}

      const loadBook = (bookUrl) => {
        try {
          if (book !== null && book !== undefined) {
            book.destroy();
          }

          if (rendition !== null && rendition !== undefined) {
            rendition.destroy();
          }

          book = ePub(bookUrl);
          rendition = book.renderTo('viewer', {
            method: 'continuous',
            width: '100%',
            height: '100%',
            allowScriptedContent: true,
          });
        } catch (err) {
          console.log(err);
        }

        rendition.display(undefined);

        rendition.themes.default({
          p: {
            margin: '30px',
          },
        });

        rendition.themes.register('custom-font', 'examples.css');
        rendition.themes.select('custom-font');
      }; // END: loadBook method

      changeLanguagePrefernce();

			var next = document.getElementById('next');
      next.addEventListener('click', goToNextPage, false );

			var prev = document.getElementById('prev');
			prev.addEventListener('click', goToPrevPage, false );
    </script>
  </body>
</html>
